
SetEnvIf Request_URI ".*" Ngx_Cache_NoCacheMode=off
SetEnvIf Request_URI ".*" Ngx_Cache_AllCacheMode
RewriteEngine on
RewriteCond %{HTTPS} !on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# URL統一化: .html から ディレクトリ形式へのリダイレクト
RewriteRule ^(.+)\.html$ /$1/ [R=301,L]

# URL統一化: /resocaba/ プレフィックスからのリダイレクト
RewriteRule ^resocaba/(.*)$ /$1 [R=301,L]

# PHPファイルへの拡張子なしアクセス（汎用）
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([a-zA-Z0-9_-]+)/?$ $1.php [L]

# Detail page routing: /jobs/{id}/ -> job.php?id={id}
RewriteRule ^job/([0-9]+)/?$ job.php?id=$1 [L,QSA]

# Feature detail routing: /feature/{id}/ -> feature.php?id={id}
RewriteRule ^feature/([0-9]+)/?$ feature.php?id=$1 [L,QSA]

# --- Image caching (added by Phase6) ---
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/jpg  "access plus 1 year"
  ExpiresByType image/png  "access plus 1 year"
  ExpiresByType image/gif  "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
</IfModule>

<IfModule mod_headers.c>
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>
