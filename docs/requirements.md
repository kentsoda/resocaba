# 要件定義書

## 背景
CMS と LP（ランディングページ）の求人・店舗管理において、画像アップロードの操作感やメタ情報の反映に複数の不具合が発生している。これにより、管理画面利用者は入力中のデータを失ったり、公開ページで意図しない情報が表示されたりしている。これらの課題を解消し、CMS の入力内容が LP に正しく反映される状態を確保する必要がある。

## 対象範囲
- 管理画面（CMS）の店舗・求人新規作成／編集ページ
- LP 側の求人カード一覧、求人詳細ページ、および掲載店舗内に表示される求人カード
- CMS と LP 間で共有される求人・店舗メタ情報（タグ、福利厚生、期間、通貨など）

## 現状の問題点
1. **画像アップロード時のフォームリセット**: CMS で画像を追加するとページがリロードされ、入力済み内容が消えてしまう。
2. **店舗新規作成の挙動不一致**: 店舗新規作成時に最新仕様が反映されず、既存編集時と処理が揃っていない。
3. **店舗画像の並び順保存不具合**: 並び順を指定して保存しても意図通りに保持されない。
4. **求人新規作成で画像ギャラリーが未提供**: 画像の追加・管理 UI が存在しない。
5. **求人編集で既存画像が削除不可**: 登録済み画像を削除する手段が機能していない。
6. **求人カードでタグが全件表示**: LP の求人カードに登録タグがすべて表示され、デザインが崩れる。
7. **求人カードのコメント編集不可**: CMS で編集可能なコメント項目が存在しないため、LP に反映できない。
8. **求人詳細ヘッダーの情報が編集不可能**: 地域名・給与・職種アイコンの情報が CMS から制御できない。
9. **求人詳細で職種・期間が不一致**: CMS で選択した職種や期間が LP で別の値に置き換わる。
10. **通貨単位が「円」で固定**: CMS で設定した通貨が LP に反映されず、常に「円」表示になる。
11. **待遇・福利厚生が LP に未表示**: CMS で設定しても求人詳細ページに表示されない。

## 目標
- CMS での画像操作がページ遷移なしで完結し、入力済みフォーム値が保持される。
- 店舗・求人の新規作成／編集で共通処理が適用され、データ整合性が保たれる。
- LP の求人カード・詳細で CMS の入力内容（タグ、コメント、通貨、福利厚生等）が正しく表示される。
- タグや福利厚生の表示上限を設け、レイアウト崩れを防ぐ。

## 成功指標
- 画像アップロード後にフォームがリセットされないことを確認できる。
- 店舗新規作成から保存したデータが編集時と同じ形式で表示される。
- 求人カード・詳細ページで CMS の入力値と表示内容が一致する。
- LP 上でタグ・福利厚生が指定上限内で収まり、デザインが破綻しない。

## 想定される影響範囲
- 管理画面の PHP・JavaScript コードへの変更
- 共通関数群（`config/functions.php` など）への改修
- LP 側テンプレートおよびスタイルの更新
- 既存データのタグ・福利厚生情報の再同期

## リスクと制約
- 画像アップロードの非同期化に伴う CSRF 対策、権限管理の追加が必要。
- 既存データの `meta_json` と新テーブル構造の差異を吸収する移行処理が求められる。
- タグ表示の上限設定により、利用者が期待するタグが非表示になる可能性があるため、並び順の明確化が必要。

## 受け入れ条件
- CMS 上で画像追加・削除・並び替えが保存前後で反映される。
- 求人カードおよび詳細ページでタグ・福利厚生・通貨などが CMS で設定した内容と一致する。
- 表示崩れが発生しないことを確認するための UI テスト（手動確認）が完了している。
