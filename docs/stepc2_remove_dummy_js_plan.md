# ステップC-2: 不要なJSの削除（ダミーデータ生成処理の除去）実装計画

最終更新: 2025-10-28 03:41 JST

## 概要
一覧ページのPHP化完了後、残存する不要なJavaScript処理（ダミーデータ生成関数）とテスト用プレースホルダー画像、テストデータをクリーンアップする。UI/UX（見た目・クラス・構造）は変更せず、不要な処理のみを削除する。

本ステップの目的は「テスト用・ダミー処理の完全除去」。PHPループ化後の重複処理やテストデータを整理し、本番環境に適したクリーンな状態にする。

実装が完了したフェーズにはマーク✅を付ける。

## 対象ファイルと修正方針

### 1. `public_html/index.php`
- **削除対象**:
  - `sampleTags` 配列（1092-1095行目）
  - `getRandomTags()` 関数（1096-1099行目）
  - `generateJobs()` 関数（1101-1133行目）
  - `generateFeatures()` 関数（1134行目以降）
- **影響範囲**: 1090-1200行目以降の「--- DATA ---」セクション全体
- **注意点**: 画像プレースホルダー（`placehold.co`）は残存確認し、必要に応じて適切なフォールバック画像に置換

### 2. `public_html/announcement.php`
- **削除対象**:
  - 圧縮されたダミーJS処理（290-320行目付近）
  - `sampleTags`, `getRandomTags`, `generateJobs`, `generateFeatures` 関連
- **影響範囲**: 290-320行目の圧縮された1行JSコード
- **注意点**: 削除後、ページが正常表示されることを確認

### 3. `public_html/job.php`
- **削除対象**:
  - テストデータ「test1002」関連のタイトル、説明、画像
  - OGP/JSON-LD内のテストデータ
  - プレースホルダー画像（`placehold.co`）の参照
- **影響範囲**: ヘッダー、JSON-LD、タイトル、画像ギャラリー、関連求人セクション
- **注意点**: DBデータがない場合の適切なエラーハンドリングを追加

### 4. `public_html/jobs.php`
- **削除対象**:
  - HTML内に埋め込まれたテストデータ（`test1002`）スニペット
  - プレースホルダー画像の参照
- **影響範囲**: 200-500行目付近の静的HTMLスニペット
- **注意点**: 削除後、PHPループが正常に動作することを確認

### 5. その他のファイル
- **プレースホルダー画像の整理**:
  - `placehold.co` ドメインの画像URLを検出・整理
  - 必要に応じて適切なフォールバック画像に置換
- **テストデータの残存確認**:
  - `test1002`, `サンプル`, `テスト` などのテストデータ文字列
  - 不要な例示テキストやダミーコンテンツ

## 実装フェーズ

### フェーズ1: 対象ファイルの分析とバックアップ ✅ 完了
- 各ファイルの不要な処理箇所を特定・マッピング
- 削除対象の処理が実際に使用されていないことを確認
- 作業前にGitバックアップを取得

### フェーズ2: `index.php` の不要なJS処理削除 ✅ 完了
- `--- DATA ---` セクション（1090-1200行目以降）を削除
- `sampleTags`, `getRandomTags`, `generateJobs`, `generateFeatures` 関数を完全削除
- プレースホルダー画像のURLを確認・整理

### フェーズ3: `announcement.php` のダミーJS処理削除 ✅ 完了
- 290-320行目の圧縮JSコードを削除（`sampleTags/getRandomTags/generateJobs/generateFeatures`）
- ページの動作が正常であることを確認（JSエラーなし）

### フェーズ4: `job.php` のテストデータクリーンアップ ✅ 完了
- 「test1002」関連のタイトル、説明、画像を削除・置換
- OGP/JSON-LDのテストデータを適切なデータに更新
- 画像ギャラリーのプレースホルダー画像を整理

### フェーズ5: `jobs.php` のテストデータHTMLスニペット削除 ✅ 完了
- `同じエリアの求人` と `ピックアップ求人` セクション内の固定カード（test1002 等）を削除
- サーバーサイド描画へ移行
  - 同じエリア: URLクエリの `area[]` / `area` / `country[]` / `country` の先頭値を用いて `get_jobs(['area' => 値], 0, 8)` で取得・描画
  - ピックアップ: `get_jobs([], 0, 100)` の結果から `meta_json.home_sections` に `pickup` を含む求人を最大8件抽出して描画
- UI/UXは既存クラス・構造を踏襲（画像/タイトル/エリア/職種/給与/リンク）
- 0件時はヘッダと「もっと見る」CTAは残し、カードのみ空（セクション自体は表示）
- JS（`setupLayouts()`）の挙動に変更なし（デスクトップ=グリッド、モバイル=Swiper）

### フェーズ6: プレースホルダー画像の整理と置き換え ✅ 完了
- 全ファイルの `placehold.co` 参照を検出・整理
- 適切なフォールバック画像（`no-image.png` など）への置換を検討
- 画像がない場合の適切な処理を確保

### フェーズ7: 影響範囲の最終確認と調整

- 削除後のページ動作確認（エラー・表示崩れなし）
- コンソールエラーや警告の確認
- 必要に応じて微調整

#### フェーズ7: 修正すべき点（ファイルベース確認結果）

- public_html/announcement.php
  - [ ] 圧縮ダミーJS/DOM生成ブロックの削除（`createJobCard`/`createFeatureCard` 等の minified 関数群）
  - [ ] 固定テストカード `test1002` の完全削除（画像/タイトル/リンクを含む静的スライド）
  - [ ] OGP/JSON-LD の画像URLを実画像へ置換（`docs/assets/image-mapping.csv` に準拠）
    - OGP: `public_html/assets/images/articles/news-ogp-1200x630.jpg`
    - JSON-LD: `public_html/assets/images/articles/announcement-hero-1200x800.jpg`
  - [ ] カード内の `placehold.co` 参照を実画像 or フォールバック方針に沿って置換

- public_html/index.php
  - [ ] `placehold.co` フォールバックの取り扱いを最終決定（仕様として許容するか、実画像へ置換するか）
    - 対象例: OGP、広告バナー、特集カードのデフォルト画像

- public_html/jobs.php
  - [ ] 同上（例: `$og_image`、特集デフォルト、広告バナーの `placehold.co`）

- public_html/job.php
  - [ ] 同上（例: 404時OGP、関連記事デフォルト、ピックアップ時フォールバック、広告バナーの `placehold.co`）

- 共通検証
  - [ ] コンソールエラー/警告が出ないこと
  - [ ] 表示崩れなし（レイアウトJS `setupLayouts()` の正常動作）
  - [ ] UI/UXの変更なし（クラス/構造は既存踏襲）

## 検証フェーズ

### 動作確認項目
1. 各ページが正常に表示される（JSエラーなし）
2. PHPループが正常に動作し、重複表示がない
3. 画像が適切に表示される（プレースホルダーなし）
4. ページパフォーマンスに悪影響がない
5. 既存のスタイル/クラス/レイアウトが維持

### テスト手順
1. 各対象ページでブラウザDevToolsを確認（JSエラーなし）
2. 画像表示が正常であることを確認
3. ページネーションやフィルタ機能が正常動作
4. モバイル・PC両方でレスポンシブ動作確認

## リスク対応

### バックアップ戦略
- 作業前にGitコミット・ブランチ作成
- 各フェーズ完了ごとにコミット
- ロールバック可能な状態を維持

### ロールバック計画
- 不要JS削除前の状態へ即時復元可能
- 画像置換に問題があれば元のURLに戻す

### 注意事項
- **JS削除の影響**: 使用されていない処理のみ削除。動作に影響する処理は残存確認必須
- **画像置換**: フォールバック画像の準備を事前に確認
- **テストデータ**: 完全削除ではなく、適切なデータへの置換を検討

## 完了基準
- [ ] `index.php` のダミーJS関数が完全削除
- [ ] `announcement.php` の圧縮JS処理が削除
- [ ] `job.php` のテストデータがクリーンアップ
- [ ] `jobs.php` のテストHTMLスニペットが削除
- [ ] プレースホルダー画像が適切に処理
- [ ] すべてのページが正常動作
- [ ] UI/UX の変更なし（見た目・構造維持）

## 実装順序推奨
1. 分析とバックアップ
2. `index.php`（影響大）
3. `announcement.php`
4. `job.php`（テストデータ中心）
5. `jobs.php`
6. プレースホルダー画像整理
7. 総合テスト・微調整

---

注意: 本ステップは不要な処理の削除に特化。UI/UX変更や新機能追加は行わない。削除の影響を最小限に抑えつつ、クリーンなコード状態を目指す。
