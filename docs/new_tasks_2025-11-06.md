# 新規タスク一覧

作成日: 2025-11-06

## 概要

新たに追加された実装タスクの一覧です。

---

## 1. 求人カードにタグ表示

### 概要
求人カードにタグ表示機能を追加し、最大5個まで表示できるようにする。

### 詳細仕様
- 求人カードのデザインにタグ表示エリアを追加
- データベース（`job_tag`テーブルと`tags`テーブル）から取得したタグ情報を表示
- 最大5個まで表示（5個を超える場合は先頭5個を表示）
- タグのスタイルは既存のデザインに合わせる（タグアイコン付き、薄い下線スタイル）

### 対象ファイル
- `config/functions.php`（`get_jobs()`関数にタグ取得処理を追加）
- `public_html/jobs.php`（求人一覧ページのカード表示）
- `public_html/job.php`（求人詳細ページ）
- `public_html/index.php`（トップページ）

### 現在の状況確認
- `jobs.php`の求人カードに`tags-container`クラス付きの空divが既に存在（343行目）
- `announcement.php`では`build_job_card_context()`関数でタグ表示が実装済み
- `get_jobs()`関数では画像取得は実装されているが、タグ取得は未実装

### 実装ステップ

#### ステップ1: get_jobs()関数にタグ取得処理を追加
**対象ファイル**: `config/functions.php`

**実装内容**:
- `get_jobs()`関数の画像取得処理に続けて、タグ取得処理を追加
- `job_tag`テーブルと`tags`テーブルをJOINしてタグ情報を取得
- 取得したタグを求人データに`tags`キーで追加

**具体的なコード変更**:
```php
// 既存の画像取得処理の後に追加
$tagSql = "SELECT jt.job_id, t.name
           FROM job_tag jt
           INNER JOIN tags t ON jt.tag_id = t.id
           WHERE jt.job_id IN ({$placeholders})
           ORDER BY jt.job_id, t.sort_order, t.name";
$tagRows = executeQuery($tagSql, $job_ids);

$tags_by_job = [];
if ($tagRows !== false) {
    foreach ($tagRows as $tagRow) {
        $tags_by_job[$tagRow['job_id']][] = $tagRow['name'];
    }
}

foreach ($jobs as &$job) {
    // 既存のimages設定
    $job['images'] = isset($images_by_job[$job['id']]) ? $images_by_job[$job['id']] : [];

    // 新規: tags設定（最大5個）
    $jobTags = isset($tags_by_job[$job['id']]) ? $tags_by_job[$job['id']] : [];
    $job['tags'] = array_slice($jobTags, 0, 5);
}
```

#### ステップ2: jobs.phpの求人カードにタグ表示を追加
**対象ファイル**: `public_html/jobs.php`

**実装内容**:
- 343行目の空の`tags-container` divにタグ表示ロジックを追加
- `announcement.php`のタグ表示スタイルを参考に実装

**具体的なコード変更**:
```php
<!-- 343行目の空divを以下に置き換え -->
<div class="flex flex-wrap gap-x-4 gap-y-1 mb-3 tags-container">
    <?php
    $jobTags = $job['tags'] ?? [];
    if (!empty($jobTags)):
        foreach ($jobTags as $tag):
    ?>
        <span class="inline-flex items-center text-slate-600 pb-px text-xs" style="border-bottom: 1px solid #e2e8f0;">
            <i data-lucide="tag" class="w-3 h-3 mr-1 flex-shrink-0"></i>
            <?= htmlspecialchars($tag, ENT_QUOTES, 'UTF-8'); ?>
        </span>
    <?php
        endforeach;
    endif;
    ?>
</div>
```

#### ステップ3: 他のページにも同様の処理を適用
**対象ファイル**: `public_html/index.php`, `public_html/job.php`

**実装内容**:
- 各ページの求人カード表示部分で同様のタグ表示処理を追加
- 各ページの`get_jobs()`呼び出し部分を確認し、必要に応じて調整

#### ステップ4: タグのソート順序と優先度の検討
**考慮事項**:
- `tags`テーブルの`sort_order`フィールドで表示順序を制御
- 重要なタグ（例: 「人気」「急募」など）を優先的に表示するか検討
- タグの最大表示数を5個とするが、必要に応じて調整可能に

### データベース構造の確認
- `job_tag`テーブル: `job_id`, `tag_id`（中間テーブル）
- `tags`テーブル: `id`, `name`, `slug`, `type`, `sort_order`

### テスト項目
1. タグ付き求人のカード表示確認
2. タグなし求人の表示確認（空表示でもレイアウト崩れなし）
3. 5個を超えるタグが付いている求人の表示確認（先頭5個のみ表示）
4. タグのスタイル確認（アイコン、下線など）
5. 異なるページでの一貫性確認

### 注意事項
- `get_jobs()`関数は複数のページで使用されているため、変更時は影響範囲を十分確認
- タグ取得クエリでパフォーマンスに影響が出ないよう、既存の画像取得と同様の構造で実装
- タグの最大表示数は定数化するか、設定可能にしておく

### 優先度
高（ユーザー体験の向上に直結）

---

## 全体の優先度順位

**求人カードにタグ表示** - 既存機能の拡張で影響範囲が限定、ユーザー体験の向上に直結

### 備考
ユーザーログイン機能、新規登録機能については後回しとし、まずはタグ表示機能の実装に集中する。

---

## 注意事項

- 各タスクの実装前に、既存のコードとの整合性を確認すること
- データベーススキーマの変更が必要な場合は、事前にバックアップを取得すること
- セキュリティ面（パスワードハッシュ化、SQLインジェクション対策など）に十分注意すること
- 実装完了後は、各機能のテストを実施すること
